## 目的

为 Mastra 应用程序提供全局工作空间和沙盒功能，支持文件操作和隔离执行环境。工作空间使用 LocalFileSystem 和 LocalSandbox 实现，通过工具配置支持对特定代理的权限限制。

## 需求

### 需求: 全局工作空间配置

系统应作为 Mastra 初始化的一部分配置全局工作空间实例，为所有代理和工作流提供文件系统和沙盒功能。

#### 场景: Mastra 启动时初始化工作空间

- **当** Mastra 应用程序启动时
- **那么** 应创建具有 LocalFileSystem 和 LocalSandbox 配置的工作空间实例
- **并且** 工作空间应可通过 Mastra 实例访问

#### 场景: 代理可访问工作空间

- **当** 使用 Mastra 实例初始化代理时
- **那么** 代理应具有对工作空间文件系统和沙盒工具的访问权限

### 需求: LocalFileSystem 集成

系统应集成 LocalFileSystem 用于本地文件存储操作，具有可配置的基本路径。

#### 场景: 文件读取操作

- **当** 代理请求读取路径为 `/docs/readme.md` 的文件时
- **那么** 系统应从配置的工作空间基本目录读取文件
- **并且** 返回文件内容

#### 场景: 文件写入操作

- **当** 代理请求将内容写入路径 `/output/result.txt` 时
- **那么** 系统应将内容写入配置的工作空间基本目录
- **并且** 如果父目录不存在则创建它们

#### 场景: 文件列表

- **当** 代理请求列出路径 `/docs/` 的文件时
- **那么** 系统应返回指定路径中的文件和目录列表

### 需求: LocalSandbox 集成

系统应集成 LocalSandbox 用于在工作空间环境中的隔离命令执行。

#### 场景: 沙盒命令执行

- **当** 代理请求执行命令 `ls` 并带有参数 `['-la']` 时
- **那么** 系统应在沙盒的工作目录中执行该命令
- **并且** 返回命令输出

#### 场景: 沙盒环境配置

- **当** 沙盒初始化时
- **那么** 系统应配置沙盒的工作目录与工作空间基本路径匹配
- **并且** 环境变量应可通过 Mastra 配置进行配置

#### 场景: 沙盒自动启动

- **当** 在沙盒中执行第一个命令时
- **那么** 如果沙盒尚未运行，系统应自动启动沙盒

### 需求: 工作空间路径配置

系统应通过环境变量或 Mastra 配置支持可配置的工作空间路径。

#### 场景: 通过环境变量自定义工作空间路径

- **假设** 环境变量 `MASTRA_WORKSPACE_PATH` 设置为 `./custom-workspace`
- **当** Mastra 应用程序启动时
- **那么** LocalFileSystem 应使用 `./custom-workspace` 作为基本路径
- **并且** LocalSandbox 应使用 `./custom-workspace` 作为工作目录

#### 场景: 默认工作空间路径

- **假设** 未设置工作空间路径环境变量
- **当** Mastra 应用程序启动时
- **那么** 系统应使用默认路径 `./workspace` 作为文件系统和沙盒的路径

### 需求: 工作空间工具配置

系统应支持通过 Workspace 的 `tools` 配置选项控制哪些工作空间工具可用，从而限制特定代理的文件操作能力。

#### 场景: 禁用写入工具

- **当** 配置 `frontendCodeGeneratorAgent` 的工作空间时
- **那么** 系统应在 Workspace 的 `tools` 配置中禁用写入相关工具
- **并且** 以下工具应被禁用：
  - `mastra_workspace_write_file`
  - `mastra_workspace_edit_file`
  - `mastra_workspace_delete`
  - `mastra_workspace_mkdir`

#### 场景: 只读代理访问

- **给定** `frontendCodeGeneratorAgent` 配置为禁用写入工具
- **当** 代理尝试读取路径为 `/docs/readme.md` 的文件时
- **那么** 系统应允许读取操作并返回文件内容

#### 场景: 只读代理写入被拒绝

- **给定** `frontendCodeGeneratorAgent` 配置为禁用写入工具
- **当** 代理尝试使用 `mastra_workspace_write_file` 工具写入文件时
- **那么** 系统应返回工具不可用错误

#### 场景: 可写代理完整访问

- **给定** 未禁用写入工具的代理
- **当** 代理尝试使用任何工作空间工具时
- **那么** 系统应允许所有操作（读取、写入、删除、执行命令）
